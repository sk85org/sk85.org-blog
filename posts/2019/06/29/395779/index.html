<!doctype html><html lang=ja xmlns=http://www.w3.org/1999/xhtml><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=filename content="20190629_395779.md"><link rel=icon href=favicon.svg type=image/svg+xml><title>Hugoで作った静的サイトのデータをgithubで管理する</title>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel=stylesheet><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/font.css></head><body><header><a href=/ title=top><span class=menu>top</span></a>&nbsp;<a href=/archives/ title=archives><span class=menu>archives</span></a>&nbsp;<a href=/tags/ title=tags><span class=menu>tags</span></a>&nbsp;<a href=/about/ title=about><span class=menu>about</span></a>&nbsp;<a href=/search/ title=search><span class=menu>search</span></a>&nbsp;</header><h1>Hugoで作った静的サイトのデータをgithubで管理する</h1><form method=get action=/search/><input type=text name=q size=20>
<input type=submit value=Search>
<input type=hidden name=enc value=UTF-8></form><time datetime=2019-06-29 id=single_page_date>2019-06-29&ensp;(土)
</time>|
Tags:
<span><a href=/tags/hugo>hugo</a>
</span>|
<span><a href=/n%E5%B9%B4%E6%97%A5%E8%A8%98/0629>n年日記</a>
</span>|
<span><a href="https://memos.sk85.org/?filter=displayTime%3A2019-06-29">今日memo</a></span><p>hugoでサイトを作るにあたって、Markdownファイルやテンプレートはgithub上で管理している。<br>github上のリポジトリにcommitがあるとgithubからwebhookが飛ぶ。<br>それを受け取ったサーバー上でgit pullして同期、その後hugoでデプロイ</p><h3 id=webhookサーバーを書いた>Webhookサーバーを書いた</h3><p><a href=https://github.com/skt1984/webhook>skt1984/webhook</a><br>hook.jsonにアドレス, シークレットキー, X-GitHub-Event及び実行したいシェルスクリプトを指定する。</p><pre tabindex=0><code>[
    {
        &#34;path&#34;: &#34;/hugo&#34;,
        &#34;name&#34;: &#34;put&#34;,
        &#34;shell&#34;: &#34;sh&#34;,
        &#34;execute-command&#34;: &#34;hugo.sh&#34;,
        &#34;execute-command-directry&#34;: &#34;/home/username/webhook&#34;,
        &#34;X-GitHub-Event&#34;: &#34;push&#34;,
        &#34;method&#34;: &#34;POST&#34;,
        &#34;secret&#34;: &#34;secret_key&#34;
    }
]
</code></pre><p>起動時にjsonファイルとポートの指定が可能</p><pre tabindex=0><code>./webhook -f hook.json -p :8080
</code></pre><p>github上のリポジトリでhostname:8080/hugoを対象にwebhookの設定を行い、commitが行われるとhugo.shが実行される。/home/username/repositoryではリモートリポジトリをgithubに指定</p><p>まずローカルにGitHubのリポジトリをcloneする</p><pre tabindex=0><code>cd /home/username
git clone git@github.com:username/repository.git
</code></pre><p>hugoのbinaryを入手</p><pre tabindex=0><code>cd /home/username/repository
git pull
cd /home/username/repository 
/path/to/hugobinary/hugo -d /phome/username/public```
</code></pre><ul><li>systemdの登録について (userを指定しないとgitpull　できない・)</li></ul><pre tabindex=0><code>[Unit]
Description = webhook

[Service]
ExecStart = /path/to/webhook/webhook -f /path/to/webhook/hook.json -p :8080
Restart = always
Type = simple
User=user

[Install]
WantedBy = multi-user.target
</code></pre><script src=https://unpkg.com/hotkeys-js/dist/hotkeys.min.js></script><script>hotkeys("n,p",function(e,t){switch(t.key){case"n":document.getElementById("next-post-link").click();break;case"p":document.getElementById("previous-post-link").click()}})</script><div id=pagination><a href=/posts/2019/06/28/125688/ id=previous-post-link><span>Prev</span>
</a>&ensp;
<a href=/posts/2019/08/16/304588/ id=next-post-link><span>Next</span>
</a><script src=https://utteranc.es/client.js repo=sk85org/sk85.org-blog-comment issue-term=pathname theme=preferred-color-scheme crossorigin=anonymous async></script></div>slug: 395779, filename: hugo_git_395779.md<footer></footer></body></html>